<!DOCTYPE html>
<html>
<head>
    <title>Network Sentinel | Graph</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        #network-graph { width: 100%; height: 80vh; background-color: #0f172a; }
        body::before {
    content: " ";
    display: block;
    position: fixed;
    top: 0; left: 0; bottom: 0; right: 0;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
    z-index: 100;
    background-size: 100% 2px, 3px 100%;
    pointer-events: none;
}

    </style>
</head>
<body class="bg-slate-900 text-white font-sans">
    <nav class="p-4 border-b border-slate-800 flex justify-between items-center">
        <button onclick="window.location.href='/'" class="text-slate-400 hover:text-white flex items-center gap-2">
            <i data-lucide="arrow-left"></i> Back to List
        </button>
        <h1 class="text-xl font-bold tracking-tight text-blue-500 text-center">NETWORK TOPOLOGY MAP</h1>
        <div class="w-20"></div> </nav>

    <div id="network-graph" class="m-4 rounded-xl border border-slate-700 shadow-2xl"></div>

    <script>
        lucide.createIcons();

        // 1. Get the data we saved in index.html
        const rawData = localStorage.getItem('networkData');
        const devices = JSON.parse(rawData || "[]");

        if (devices.length === 0) {
            alert("No scan data found. Please run a scan first.");
            window.location.href = "/";
        }

        // 2. Prepare Nodes and Edges
        const nodes = [];
        const edges = [];

        // Identify the Router (assuming .1 is the gateway)
        const router = devices.find(d => d.ip.endsWith('.1')) || devices[0];

        // Add the Router (The Hub)
        nodes.push({
    id: 'router',
    label: `GATEWAY\n${router.ip}`,
    shape: 'diamond',
    color: { background: '#000000', border: '#10b981' }, // Black background, emerald border
    font: { color: '#10b981', size: 16, face: 'monospace' },
    size: 35
});

        // Add other devices (The Spokes)
        devices.forEach((device, index) => {
    if (device.ip === router.ip) return;

    const nodeId = `device-${index}`;
    nodes.push({
        id: nodeId,
        label: `${device.vendor}\n${device.ip}`,
        shape: 'dot',
        color: { background: '#000000', border: '#059669' }, // Darker emerald
        font: { color: '#059669', size: 12, face: 'monospace' },
        size: 15
    });

    // Dark green edges
    edges.push({ from: 'router', to: nodeId, color: '#064e3b', width: 1 });
});

        // 3. Initialize the Graph
        const container = document.getElementById('network-graph');
        const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
        const options = {
    physics: {
        forceAtlas2Based: {
            gravitationalConstant: -200,
            centralGravity: 0.005,
            springLength: 250,
            springConstant: 0.18,
            avoidOverlap: 1 
        },
        maxVelocity: 50,
        solver: 'forceAtlas2Based',
        stabilization: {
            iterations: 150
        }
    },
    nodes: {
        margin: 10,
        font: {
            size: 14
        }
    },
    interaction: {
        hover: true,
        navigationButtons: true,
        keyboard: true
    }
};
        new vis.Network(container, data, options);
    </script>
</body>
</html>